<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Party Management App</title>

<link rel="manifest" href="manifest.json">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Party Ledger">

<style>
body {
    font-family: Arial;
    background:#f2f4f7;
    margin:0;
    padding:15px;
}
h1 { text-align:center; }

.card {
    background:white;
    padding:20px;
    margin-bottom:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

input, select, button {
    width:100%;
    padding:12px;
    margin:6px 0;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:16px;
}

button {
    background:#1f3c88;
    color:white;
    border:none;
    font-weight:bold;
}

table {
    width:100%;
    border-collapse:collapse;
}

th, td {
    border:1px solid #ddd;
    padding:8px;
    text-align:center;
    font-size:14px;
}

.negative { color:red; font-weight:bold; }
</style>
</head>

<body>

<h1>Party Ledger</h1>

<div class="card">
<h2>Add Party</h2>
<input type="text" id="partyName" placeholder="Party Name">
<button onclick="addParty()">Add Party</button>
</div>

<div class="card">
<h2>Add Entry</h2>
<select id="partySelect"></select>
<input type="date" id="date">
<input type="number" id="purchase" placeholder="Purchase">
<input type="number" id="payment" placeholder="Payment">
<button onclick="addTransaction()">Save</button>
</div>

<div class="card">
<h2>Summary</h2>
<table>
<thead>
<tr>
<th>Party</th>
<th>Purchase</th>
<th>Paid</th>
<th>Pending</th>
</tr>
</thead>
<tbody id="summaryTable"></tbody>
</table>
</div>

<script>

const STORAGE_KEY = "PWA_PARTY_LEDGER";

let parties = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

function saveData(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(parties));
}

function format(num){
    return Number(num).toLocaleString("en-IN");
}

function addParty(){
    const name = document.getElementById("partyName").value.trim();
    if(!name) return;

    parties.push({name, transactions:[]});
    saveData();
    render();
    document.getElementById("partyName").value="";
}

function addTransaction(){
    const index = document.getElementById("partySelect").value;
    const date = document.getElementById("date").value;
    const purchase = parseFloat(document.getElementById("purchase").value) || 0;
    const payment = parseFloat(document.getElementById("payment").value) || 0;

    if(index==="" || !date) return;

    parties[index].transactions.push({date,purchase,payment});
    saveData();
    render();
}

function render(){
    const select = document.getElementById("partySelect");
    const table = document.getElementById("summaryTable");

    select.innerHTML="";
    table.innerHTML="";

    parties.forEach((p,index)=>{
        select.innerHTML+=`<option value="${index}">${p.name}</option>`;

        let totalPurchase=0;
        let totalPaid=0;

        p.transactions.forEach(t=>{
            totalPurchase+=t.purchase;
            totalPaid+=t.payment;
        });

        const pending = totalPurchase-totalPaid;

        table.innerHTML+=`
        <tr>
        <td>${p.name}</td>
        <td>Rs. ${format(totalPurchase)}</td>
        <td>Rs. ${format(totalPaid)}</td>
        <td class="negative">Rs. ${format(pending)}</td>
        </tr>
        `;
    });
}

render();

</script>

</body>
</html>