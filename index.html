<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Party Ledger</title>

<style>
body { font-family: Arial; background:#f2f4f7; margin:0; padding:15px; }
h1 { text-align:center; }

.card {
    background:white;
    padding:20px;
    margin-bottom:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

input, select, button {
    width:100%;
    padding:12px;
    margin:6px 0;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:16px;
}

button {
    background:#1f3c88;
    color:white;
    border:none;
    font-weight:bold;
    cursor:pointer;
}

table {
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}

th, td {
    border:1px solid #ddd;
    padding:8px;
    text-align:center;
    font-size:14px;
}

.negative { color:red; font-weight:bold; }
</style>
</head>

<body>

<h1>Party Ledger</h1>

<div class="card">
<h2>Add Party</h2>
<input type="text" id="partyName" placeholder="Party Name">
<button onclick="addParty()">Add Party</button>
</div>

<div class="card">
<h2>Add Purchase / Payment</h2>
<select id="partySelect"></select>
<input type="date" id="date">
<input type="number" id="purchase" placeholder="Purchase Amount">
<input type="number" id="payment" placeholder="Payment Made">
<input type="text" id="billLink" placeholder="Paste Bill Link (Google Drive / URL)">
<button onclick="addTransaction()">Save Entry</button>
</div>

<div class="card">
<h2>Transaction Summary</h2>
<table>
<thead>
<tr>
<th>Party</th>
<th>Date</th>
<th>Purchase</th>
<th>Payment</th>
<th>Pending</th>
<th>Bill</th>
</tr>
</thead>
<tbody id="summaryTable"></tbody>
</table>
</div>

<div class="card">
<h2>Transaction History (Party Totals)</h2>
<table>
<thead>
<tr>
<th>Party</th>
<th>Total Purchase</th>
<th>Total Paid</th>
<th>Total Pending</th>
</tr>
</thead>
<tbody id="historyTable"></tbody>
</table>
</div>

<script>

const STORAGE_KEY = "PARTY_LEDGER_FINAL_VERSION";
let parties = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

function saveData(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(parties));
}

function format(num){
    return Number(num).toLocaleString("en-IN");
}

function addParty(){
    const name = document.getElementById("partyName").value.trim();
    if(!name) return;

    parties.push({name, transactions:[]});
    saveData();
    render();
    document.getElementById("partyName").value="";
}

function addTransaction(){
    const index = document.getElementById("partySelect").value;
    const date = document.getElementById("date").value;
    const purchase = parseFloat(document.getElementById("purchase").value) || 0;
    const payment = parseFloat(document.getElementById("payment").value) || 0;
    const billLink = document.getElementById("billLink").value.trim();

    if(index==="" || !date){
        alert("Select party and date");
        return;
    }

    parties[index].transactions.push({
        date,
        purchase,
        payment,
        billLink
    });

    saveData();
    render();

    document.getElementById("purchase").value="";
    document.getElementById("payment").value="";
    document.getElementById("billLink").value="";
}

function render(){

    const select = document.getElementById("partySelect");
    const table = document.getElementById("summaryTable");
    const historyTable = document.getElementById("historyTable");

    select.innerHTML="";
    table.innerHTML="";
    historyTable.innerHTML="";

    parties.forEach((party,partyIndex)=>{

        select.innerHTML += `<option value="${partyIndex}">${party.name}</option>`;

        let totalPurchase = 0;
        let totalPaid = 0;

        party.transactions.forEach((t)=>{

            totalPurchase += Number(t.purchase);
            totalPaid += Number(t.payment);

            const pending = t.purchase - t.payment;

            let billSection = "No Bill";
            if(t.billLink){
                billSection = `<a href="${t.billLink}" target="_blank">View Bill</a>`;
            }

            table.innerHTML += `
            <tr>
            <td>${party.name}</td>
            <td>${t.date}</td>
            <td>Rs. ${format(t.purchase)}</td>
            <td>Rs. ${format(t.payment)}</td>
            <td class="negative">Rs. ${format(pending)}</td>
            <td>${billSection}</td>
            </tr>
            `;
        });

        const totalPending = totalPurchase - totalPaid;

        historyTable.innerHTML += `
        <tr>
        <td>${party.name}</td>
        <td>Rs. ${format(totalPurchase)}</td>
        <td>Rs. ${format(totalPaid)}</td>
        <td class="negative">Rs. ${format(totalPending)}</td>
        </tr>
        `;
    });

    if(table.innerHTML===""){
        table.innerHTML=`<tr><td colspan="6">No Transactions</td></tr>`;
    }
}

render();

</script>

</body>
</html>
